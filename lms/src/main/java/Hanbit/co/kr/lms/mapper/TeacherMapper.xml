<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- WHERE CONCAT( '%', t.teacher_name , '%' ) LIKE CONCAT( '%', #{ searchValue }, '%' ) -->
<mapper namespace="Hanbit.co.kr.lms.mapper.TeacherMapper">
	<!-- 강사의  -->
	<select id="getTeacherList" parameterType="String" resultType="java.util.Map">
		SELECT
			 a.teacher_id teacherId
			,a.teacher_name teacherName
			,a.teacher_email teacherEmail
			,a.PhotoName photoName
			,GROUP_CONCAT(b.certification_name) certificationName
			,GROUP_CONCAT(c.lec_plan_name) lecPlanName
			FROM(SELECT 
					 t.teacher_id
					,t.teacher_name
					,t.teacher_email
					,CONCAT(pf.photo_name,'.',pf.photo_type) photoName
				FROM teacher t
					LEFT JOIN photo_file pf
						ON t.teacher_id = pf.member_id
				WHERE CONCAT( '%', t.teacher_name , '%' ) LIKE CONCAT( '%', #{searchValue} , '%' )
				GROUP BY t.teacher_id) a 
					LEFT JOIN (SELECT member_id,certification_name FROM certification) b
					ON a.teacher_id = b.member_id
					LEFT JOIN (SELECT teacher_id, lec_plan_name FROM lec_plan)c
					ON a.teacher_id = c.teacher_id
		GROUP BY a.teacher_name
	</select>
</mapper>

