<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Hanbit.co.kr.lms.mapper.QuestionnaireMapper">

	<select id="selectQuestioncheck" parameterType="String" resultType="int">
		SELECT COUNT(*)
		FROM questionnaire_answer
		WHERE student_id = #{studentId}			 
	</select>
	
	<select id="selectlecList" parameterType="String" resultType="Hanbit.co.kr.lms.vo.Registration">
		SELECT lecture_name lectureName
		FROM registration
		WHERE student_id = #{studentId}		
	</select>
	
	<select id="selectQuestionnaireList" parameterType="String"
		resultType="Hanbit.co.kr.lms.vo.Questionnaire">
			SELECT 
				lecture_name lectureName
				,evaluation_no evaluationNo
				,category
				,questionnaire_content questionnaireContent
			FROM questionnaire
			WHERE lecture_name = #{lectureName}
	</select>
	
	<insert id="selectQuestionnairecheck" parameterType="java.util.Map">
		INSERT INTO questionnaire_answer
			(questionnaire_no
			, student_id
			, selected_evaluation_no
			, create_date
			, update_date
		) VALUES
			(
			#{que}
			,#{studentId}			 
			,#{check}
			, NOW()
			, NOW()
			)
	</insert>
	
	<select id="selectLecCategoryQueScore" parameterType="String" resultType="java.util.Map">
		SELECT q.lecture_name lectureName 
			,q.questionnaire_content questionnaireContent
			, ROUND(AVG(qa.selected_evaluation_no),1) selectedEvaluationNo
		FROM questionnaire_answer qa INNER JOIN questionnaire q
		ON qa.questionnaire_no = q.questionnaire_no
		WHERE q.lecture_name = #{lectureName}
		GROUP BY q.category
	</select>
	
	<select id="selectLecScore" resultType="java.util.Map">
		SELECT q.lecture_name lectureName 
		, ROUND(AVG(qa.selected_evaluation_no),1) selectedEvaluationNo
		FROM questionnaire_answer qa INNER JOIN questionnaire q
		ON qa.questionnaire_no = q.questionnaire_no
		GROUP BY q.lecture_name
	</select>
	
</mapper>